webpackJsonp([41],{1003:function(e,t,a){var i=a(1004);"string"==typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);a(20)("de1a38d6",i,!1)},1004:function(e,t,a){t=e.exports=a(19)(void 0),t.push([e.i,'\n.margin-top-8 {\n  margin-top: 8px;\n}\n.margin-top-10 {\n  margin-top: 10px;\n}\n.margin-top-20 {\n  margin-top: 20px;\n}\n.margin-left-10 {\n  margin-left: 10px;\n}\n.margin-left-50 {\n  margin-left: 50px;\n}\n.margin-bottom-10 {\n  margin-bottom: 10px;\n}\n.margin-bottom-100 {\n  margin-bottom: 100px;\n}\n.margin-right-10 {\n  margin-right: 10px;\n}\n.margin-right-20 {\n  margin-right: 20px;\n}\n.padding-bottom-10 {\n  padding-bottom: 10px;\n}\n.padding-left-6 {\n  padding-left: 6px;\n}\n.padding-left-8 {\n  padding-left: 5px;\n}\n.padding-left-10 {\n  padding-left: 10px;\n}\n.padding-left-20 {\n  padding-left: 20px;\n}\n.height-100 {\n  height: 100%;\n}\n.height-120px {\n  height: 100px;\n}\n.height-200px {\n  height: 200px;\n}\n.height-492px {\n  height: 492px;\n}\n.height-460px {\n  height: 460px;\n}\n.line-gray {\n  height: 0;\n  border-bottom: 2px solid #dcdcdc;\n}\n.notwrap {\n  word-break: keep-all;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n.padding-left-5 {\n  padding-left: 10px;\n}\n[v-cloak] {\n  display: none;\n}\n.clearfix:after {\n  content: ".";\n  clear: both;\n  display: block;\n  height: 0;\n  overflow: hidden;\n  visibility: hidden;\n}\n.clearfix {\n  zoom: 1;\n}\n.fl {\n  float: left;\n}\n.fr {\n  float: right;\n}\n.file {\n  position: relative;\n  display: inline-block;\n  background: #D0EEFF;\n  border: 1px solid #99D3F5;\n  border-radius: 4px;\n  padding: 4px 12px;\n  overflow: hidden;\n  color: #1E88C7;\n  text-decoration: none;\n  text-indent: 0;\n  line-height: 20px;\n}\n.file input {\n  position: absolute;\n  font-size: 100px;\n  right: 0;\n  top: 0;\n  opacity: 0;\n}\n.file:hover {\n  background: #AADFFD;\n  border-color: #78C3F3;\n  color: #004974;\n  text-decoration: none;\n}\n.my-upload div table tr {\n  font-size: 12px;\n}\n.greyCol {\n  color: #999;\n}\n.expand-row {\n  margin-bottom: 16px;\n  margin-top: 16px;\n  font-size: 12px;\n}\ntextarea.ivu-input {\n  font-size: 12px;\n}\n.soltTitlel {\n  line-height: 2;\n  padding: 0 16px;\n  margin-left: -16px;\n  margin-right: -19px;\n  font-weight: 900;\n  color: #464c5b;\n}\n.soltTitle {\n  line-height: 1;\n  border-bottom: 1px solid #e3e8ee;\n  padding: 17px 16px;\n  margin-left: -16px;\n  margin-right: -19px;\n  font-weight: 900;\n  color: #464c5b;\n}\n.soltTitlel {\n  line-height: 2;\n  padding: 0 16px;\n  margin-left: -16px;\n  margin-right: -19px;\n  font-weight: 900;\n  color: #464c5b;\n}\ntextarea.ivu-input {\n  font-size: 12px;\n}\n',""])},1005:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{background:"#eee"}},[a("Card",{staticClass:"margin-bottom-10",attrs:{bordered:!1}},[a("Row",{attrs:{align:"middle",type:"flex"}},[a("Col",{attrs:{span:"8"}},[1001==this.$route.query.invoiceState?a("p",{staticClass:"soltTitlel"},[e._v("新增发票")]):a("p",{staticClass:"soltTitlel"},[e._v("编辑发票")])]),e._v(" "),a("Col",{attrs:{span:"5",offset:"11"}},[a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:function(t){e.invoiceSave(0)}}},[e._v("保存")]),e._v(" "),a("Button",{attrs:{type:"primary",loading:e.loading},on:{click:function(t){e.invoiceSave(1)}}},[e._v("保存并提交")]),e._v(" "),a("Button",{attrs:{type:"ghost"},on:{click:function(t){e.backlist()}}},[e._v("取消")])],1)],1)],1),e._v(" "),a("Card",{staticClass:"margin-bottom-10",attrs:{bordered:!1}},[a("Collapse",{model:{value:e.collapse,callback:function(t){e.collapse=t},expression:"collapse"}},[a("Panel",{attrs:{name:"1"}},[e._v("\n                基本信息\n                "),a("p",{attrs:{slot:"content"},slot:"content"},[a("Form",{ref:"formInvoice",attrs:{"label-position":"top"}},["验收开票"==e.applyMethod?a("div",[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开票方式"}},[a("RadioGroup",{model:{value:e.applyMethod,callback:function(t){e.applyMethod=t},expression:"applyMethod"}},[a("Radio",{attrs:{label:"验收开票",disabled:""}}),e._v(" "),a("Radio",{attrs:{label:"直接开票",disabled:""}})],1)],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"订单信息"}},[a("Input",{attrs:{placeholder:"订单信息",disabled:""},model:{value:e.contractName,callback:function(t){e.contractName=t},expression:"contractName"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"到货验收单"}},[a("Input",{attrs:{placeholder:"到货验收单",disabled:""},model:{value:e.arrivalCheckBillNo,callback:function(t){e.arrivalCheckBillNo=t},expression:"arrivalCheckBillNo"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"开票类型"}},[a("Input",{attrs:{placeholder:"到货验开票类型收单",disabled:""},model:{value:e.invoiceType,callback:function(t){e.invoiceType=t},expression:"invoiceType"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开票金额"}},[a("Input",{attrs:{placeholder:"开票金额",disabled:""},model:{value:e.invoiceMoney,callback:function(t){e.invoiceMoney=t},expression:"invoiceMoney"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"税额"}},[a("Input",{attrs:{placeholder:"税额",disabled:""},model:{value:e.taxedMoney,callback:function(t){e.taxedMoney=t},expression:"taxedMoney"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"采购商名称"}},[a("Input",{attrs:{placeholder:"采购商名称",disabled:""},model:{value:e.relativerName,callback:function(t){e.relativerName=t},expression:"relativerName"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"备注"}},[a("Input",{attrs:{type:"textarea",maxlength:255,disabled:""},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)],1)],1)],1):e._e(),e._v(" "),"直接开票"==e.applyMethod?a("div",[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开票方式"}},[a("RadioGroup",{model:{value:e.applyMethod,callback:function(t){e.applyMethod=t},expression:"applyMethod"}},[a("Radio",{attrs:{label:"验收开票",disabled:""}}),e._v(" "),a("Radio",{attrs:{label:"直接开票",disabled:""}})],1)],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"订单信息"}},[a("Input",{attrs:{placeholder:"订单信息",disabled:""},model:{value:e.contractName,callback:function(t){e.contractName=t},expression:"contractName"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开票类型"}},[a("Input",{attrs:{placeholder:"到货验开票类型收单",disabled:""},model:{value:e.invoiceType,callback:function(t){e.invoiceType=t},expression:"invoiceType"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"开票金额"}},[a("Input",{attrs:{placeholder:"开票金额",disabled:""},model:{value:e.invoiceMoney,callback:function(t){e.invoiceMoney=t},expression:"invoiceMoney"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"税额"}},[a("Input",{attrs:{placeholder:"税额",disabled:""},model:{value:e.taxedMoney,callback:function(t){e.taxedMoney=t},expression:"taxedMoney"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"采购商名称"}},[a("Input",{attrs:{placeholder:"采购商名称",disabled:""},model:{value:e.relativerName,callback:function(t){e.relativerName=t},expression:"relativerName"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"备注"}},[a("Input",{attrs:{type:"textarea",maxlength:255,disabled:""},model:{value:e.remark,callback:function(t){e.remark=t},expression:"remark"}})],1)],1)],1)],1):e._e()])],1)]),e._v(" "),a("Panel",{attrs:{name:"2"}},[e._v("\n                购货单位\n                "),a("p",{attrs:{slot:"content"},slot:"content"},[a("Form",{ref:"formInvoice",attrs:{"label-position":"top"}},[a("div",[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"购货单位"}},[a("Input",{attrs:{placeholder:"购货单位",disabled:""},model:{value:e.purchaserName,callback:function(t){e.purchaserName=t},expression:"purchaserName"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"纳税识别号"}},[a("Input",{attrs:{placeholder:"纳税识别号",disabled:""},model:{value:e.purchaserCreditNo,callback:function(t){e.purchaserCreditNo=t},expression:"purchaserCreditNo"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开户行"}},[a("Input",{attrs:{placeholder:"开户行",disabled:""},model:{value:e.purchaserBankName,callback:function(t){e.purchaserBankName=t},expression:"purchaserBankName"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"开户账号"}},[a("Input",{attrs:{placeholder:"开户账号",disabled:""},model:{value:e.purchaserBankAccount,callback:function(t){e.purchaserBankAccount=t},expression:"purchaserBankAccount"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"地址"}},[a("Input",{attrs:{placeholder:"地址",disabled:""},model:{value:e.purchaserAddr,callback:function(t){e.purchaserAddr=t},expression:"purchaserAddr"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"电话"}},[a("Input",{attrs:{placeholder:"电话",disabled:""},model:{value:e.purchaserTel,callback:function(t){e.purchaserTel=t},expression:"purchaserTel"}})],1)],1)],1)],1)])],1)]),e._v(" "),a("Panel",{attrs:{name:"3"}},[e._v("\n                销货单位\n                "),a("p",{attrs:{slot:"content"},slot:"content"},[a("Form",{ref:"formInvoice",attrs:{"label-position":"top"}},[a("div",[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"销货单位"}},[a("Input",{attrs:{placeholder:"购货单位",disabled:""},model:{value:e.supplierName,callback:function(t){e.supplierName=t},expression:"supplierName"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"纳税识别号"}},[a("Input",{attrs:{placeholder:"纳税识别号",disabled:""},model:{value:e.supplierCreditNo,callback:function(t){e.supplierCreditNo=t},expression:"supplierCreditNo"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开户行"}},[a("Input",{attrs:{placeholder:"开户行",disabled:""},model:{value:e.supplierBankName,callback:function(t){e.supplierBankName=t},expression:"supplierBankName"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"开户账号"}},[a("Input",{attrs:{placeholder:"开户账号",disabled:""},model:{value:e.supplierBankAccount,callback:function(t){e.supplierBankAccount=t},expression:"supplierBankAccount"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"地址"}},[a("Input",{attrs:{placeholder:"地址",disabled:""},model:{value:e.supplierAddr,callback:function(t){e.supplierAddr=t},expression:"supplierAddr"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"电话"}},[a("Input",{attrs:{placeholder:"电话",disabled:""},model:{value:e.supplierTel,callback:function(t){e.supplierTel=t},expression:"supplierTel"}})],1)],1)],1)],1)])],1)]),e._v(" "),a("Panel",{attrs:{name:"4"}},[e._v("\n                开票申请明细\n                "),a("p",{attrs:{slot:"content"},slot:"content"},[a("Table",{ref:"selection",attrs:{size:"small",border:"",columns:e.columns,data:e.dataList}})],1)])],1)],1),e._v(" "),a("Card",{staticClass:"margin-bottom-10",attrs:{bordered:!1}},[a("p",{attrs:{slot:"title"},slot:"title"},[a("Icon",{attrs:{type:"navicon"}}),e._v(" 发票登记\n            "),a("a",{staticClass:"fr",attrs:{href:"javascript:;"},on:{click:function(t){e.deleteFn()}}},[a("Icon",{attrs:{type:"trash-a"}}),e._v(" 删除")],1),e._v(" "),a("a",{staticClass:"fr margin-right-20",attrs:{href:"javascript:;"},on:{click:function(t){e.addInvoiceDetails()}}},[a("Icon",{attrs:{type:"plus"}}),e._v(" 批量添加")],1),e._v(" "),a("a",{staticClass:"fr margin-right-20",attrs:{href:"javascript:;"},on:{click:function(t){e.addInvoice()}}},[a("Icon",{attrs:{type:"plus"}}),e._v(" 添加")],1)],1),e._v(" "),a("Row",{staticClass:"margin-bottom-10",attrs:{align:"middle",type:"flex"}},[a("Col",{attrs:{span:"3"}},[a("p",[e._v("已添加数据条数("+e._s(this.detailData.length)+")")])]),e._v(" "),a("Col",{attrs:{span:"3"}},[a("p",[e._v("开票金额   :   "+e._s(e.invoiceMoney))])]),e._v(" "),a("Col",{attrs:{span:"3"}},[a("p",[e._v("已开发票金额   :   "+e._s(e.taxIncludedSum))])])],1),e._v(" "),a("Table",{attrs:{height:"200",columns:e.invoiceColumns,data:e.detailData,size:"small",border:!1},on:{"on-selection-change":e.selectModel,"on-row-click":e.clickRow}})],1),e._v(" "),a("Card",{attrs:{bordered:!1}},[a("Row",[a("Col",{attrs:{span:"24"}},[a("p",{staticClass:"soltTitle margin-bottom-10"},[a("Icon",{attrs:{type:"flag"}}),e._v(" 附件")],1)]),e._v(" "),a("Col",{attrs:{span:"24"}},[a("div",{staticClass:"my-upload"},[a("a",{staticClass:"file",attrs:{href:"javascript:;",disabled:e.flieDisabled},on:{change:function(t){e.upFile(t)}}},[e._v("选择文件\n                        "),a("input",{attrs:{type:"file",name:"",id:""}})]),e._v(" "),a("div",[a("table",e._l(e.filesList,function(t,i){return a("tr",{staticStyle:{"font-size":"12px"}},[a("td",{staticStyle:{padding:"0 10px"}},[e._v(e._s(i+1))]),e._v(" "),a("td",{staticStyle:{padding:"0 10px"}},[e._v(e._s(t.name))]),e._v(" "),a("td",{staticStyle:{padding:"0 10px"}},[a("a",{attrs:{href:"javascript:;"},on:{click:function(t){e.delFile(i)}}},[e._v("删除")])])])}))])])])],1)],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:e.digType?"编辑发票明细":"新增发票明细",width:"50%"},on:{"on-cancel":e.cancel},model:{value:e.modal1,callback:function(t){e.modal1=t},expression:"modal1"}},[a("Form",{ref:"formDetail",attrs:{"label-position":"top",model:e.formDetail,rules:e.ruleValidate}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"发票代码",prop:"invoiceCode"}},[a("Input",{attrs:{placeholder:"发票代码"},model:{value:e.formDetail.invoiceCode,callback:function(t){e.$set(e.formDetail,"invoiceCode",t)},expression:"formDetail.invoiceCode"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"发票号码",prop:"invoiceNo"}},[a("Input",{attrs:{placeholder:"发票号码"},model:{value:e.formDetail.invoiceNo,callback:function(t){e.$set(e.formDetail,"invoiceNo",t)},expression:"formDetail.invoiceNo"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"发票金额",prop:"taxIncludedSum"}},[a("Input",{attrs:{placeholder:"发票金额"},model:{value:e.formDetail.taxIncludedSum,callback:function(t){e.$set(e.formDetail,"taxIncludedSum",t)},expression:"formDetail.taxIncludedSum"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"开票日期",prop:"registryDate"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"开票日期"},model:{value:e.formDetail.registryDate,callback:function(t){e.$set(e.formDetail,"registryDate",t)},expression:"formDetail.registryDate"}})],1)],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",loading:e.modal_loading},on:{click:function(t){e.sureInvoice("formDetail")}}},[e._v(e._s((e.digType,"保存")))]),e._v(" "),a("Button",{attrs:{type:"ghost",loading:e.modal_loading},on:{click:function(t){e.cancel()}}},[e._v("取消")])],1)],1),e._v(" "),a("Modal",{attrs:{"mask-closable":!1,title:"批量新增发票明细",width:"50%"},on:{"on-cancel":e.cancel},model:{value:e.modalDetails,callback:function(t){e.modalDetails=t},expression:"modalDetails"}},[a("Form",{ref:"formDetails",attrs:{"label-position":"top",model:e.formDetails,rules:e.ruleValidates}},[a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"发票代码",prop:"invoiceCode"}},[a("Input",{attrs:{placeholder:"发票代码"},model:{value:e.formDetails.invoiceCode,callback:function(t){e.$set(e.formDetails,"invoiceCode",t)},expression:"formDetails.invoiceCode"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"发票起始号码",prop:"invoiceStartNo"}},[a("Input",{attrs:{placeholder:"发票起始号码"},model:{value:e.formDetails.invoiceStartNo,callback:function(t){e.$set(e.formDetails,"invoiceStartNo",t)},expression:"formDetails.invoiceStartNo"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"发票结束号码",prop:"invoiceEndNo"}},[a("Input",{attrs:{placeholder:"发票起始号码"},model:{value:e.formDetails.invoiceEndNo,callback:function(t){e.$set(e.formDetails,"invoiceEndNo",t)},expression:"formDetails.invoiceEndNo"}})],1)],1),e._v(" "),a("Col",{attrs:{span:"11",offset:"2"}},[a("FormItem",{attrs:{label:"发票金额",prop:"taxIncludedSum"}},[a("Input",{attrs:{placeholder:"发票金额"},model:{value:e.formDetails.taxIncludedSum,callback:function(t){e.$set(e.formDetails,"taxIncludedSum",t)},expression:"formDetails.taxIncludedSum"}})],1)],1)],1),e._v(" "),a("Row",[a("Col",{attrs:{span:"11"}},[a("FormItem",{attrs:{label:"开票日期",prop:"registryDate"}},[a("DatePicker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"开票日期"},model:{value:e.formDetails.registryDate,callback:function(t){e.$set(e.formDetails,"registryDate",t)},expression:"formDetails.registryDate"}})],1)],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"primary",loading:e.modal_loading},on:{click:function(t){e.sureDetails("formDetails")}}},[e._v("保存")]),e._v(" "),a("Button",{attrs:{type:"ghost",loading:e.modal_loading},on:{click:function(t){e.cancel()}}},[e._v("取消")])],1)],1)],1)},n=[];i._withStripped=!0;var o={render:i,staticRenderFns:n};t.default=o},287:function(e,t,a){"use strict";function i(e){c||a(1003)}Object.defineProperty(t,"__esModule",{value:!0});var n=a(554),o=a.n(n);for(var l in n)"default"!==l&&function(e){a.d(t,e,function(){return n[e]})}(l);var r=a(1005),s=a.n(r),c=!1,d=a(4),p=i,u=d(o.a,s.a,!1,p,null,null);u.options.__file="src/views/clearingTicket/component/invoiceAdd.vue",t.default=u.exports},554:function(e,t,a){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=a(39),o=i(n),l=a(111),r=i(l),s=a(5),c=(i(s),a(15)),d=i(c);t.default={name:"",data:function(){return{taxIncludedSum:"",collapse:"",file:"",list:[],filesList:[],flieDisabled:!1,loading:!1,modal_loading:!1,invoiceApplicationId:"",applyMethod:"",invocieApplicationId:"",noticeNo:"",contractCode:"",contractName:"",arrivalCheckBillNo:"",invoiceType:"",invoiceMoney:"",taxedMoney:"",purchaserName:"",invoiceRule:"",remark:"",relativerName:"",invoiceRuleName:"",purchaserCreditNo:"",purchaserBankName:"",purchaserBankAccount:"",purchaserAddr:"",purchaserTel:"",supplierName:"",supplierCreditNo:"",supplierBankName:"",supplierBankAccount:"",supplierAddr:"",supplierTel:"",dataList:[],columns:[{title:"序号",type:"index",width:80,align:"center",fixed:"left"},{title:"物资名称",key:"materialName",align:"center",width:300},{title:"规格型号",key:"spectype",align:"center"},{title:"单位",key:"metricunitName",align:"center"},{title:"数量",key:"settlementQuantity",align:"center"},{title:"单价(未税)",key:"price",align:"center"},{title:"金额(未税)",key:"taxExclusiveAmount",align:"center",render:function(e,t){return e("span",d.default.formatNum(t.row.price*t.row.settlementQuantity,2))}},{title:"税率",key:"itemTaxs",align:"center"},{title:"税额",key:"itemTaxAmount",align:"center",render:function(e,t){return e("span",d.default.formatNum(t.row.price*t.row.settlementQuantity*t.row.itemTax,2))}}],invoiceColumns:[{type:"selection",width:120,align:"center",fixed:"left"},{title:"序号",type:"index",width:100,align:"center"},{title:"发票代码",key:"invoiceCode",align:"center",width:400},{title:"发票号码",key:"invoiceNo",align:"center",width:400},{title:"发票金额",key:"taxIncludedSum",align:"center",width:300},{title:"开票日期",key:"registryDate",align:"center",width:300}],detailData:[],deleteList:[],modal1:!1,digType:!1,num:0,formDetail:{invoiceCode:"",invoiceNo:"",taxIncludedSum:"",registryDate:"",invoiceApplicationId:""},formDetails:{invoiceCode:"",invoiceNo:"",invoiceStartNo:"",invoiceEndNo:"",taxIncludedSum:"",invoiceApplicationId:"",registryDate:""},ruleValidate:{invoiceCode:[{required:!0,message:"请输入发票代码",trigger:"blur"}],invoiceNo:[{required:!0,message:"请输入发票号码",trigger:"blur"}],taxIncludedSum:[{required:!0,message:"发票金额请输入数字",trigger:"blur",pattern:/^\d+(\.\d+)?$/}],registryDate:[{required:!0,message:"请选择开票日期",trigger:"change",pattern:/.+/}]},ruleValidates:{invoiceCode:[{required:!0,message:"请输入发票代码",trigger:"blur"}],invoiceStartNo:[{required:!0,message:"请输入发票起始号码",trigger:"blur"}],invoiceEndNo:[{required:!0,message:"请输入发票结束号码",trigger:"blur"}],taxIncludedSum:[{required:!0,message:"发票金额请输入数字",trigger:"blur",pattern:/^[0-9]*$/}],registryDate:[{required:!0,message:"请选择开票日期",trigger:"change",pattern:/.+/}]},modalDetails:!1}},mounted:function(){this.init(),this.initFormatter()},watch:{$route:function(){this.init()},filesList:function(e){e.length>=5?this.flieDisabled=!0:this.flieDisabled=!1},detailData:function(e){var t=e.map(function(e){return"number"==typeof e.taxIncludedSum?e.taxIncludedSum:d.default.formatFalNum(e.taxIncludedSum)}),a=t.reduce(function(e,t){return e+t},0);this.taxIncludedSum=a}},methods:{init:function(){switch(this.$route.query.invoiceState){case 1001:this.invoiceApplicationId=this.$route.query.invoiceApplicationId,this.getInvoiceMainInfo(),this.invoiceList();break;case 1002:this.invoiceApplicationId=this.$route.query.invoiceApplicationId,this.getInvoiceMainInfo(),this.invoiceList(),this.getInvoiceDetail()}},initFormatter:function(){Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e}},getInvoiceMainInfo:function(){var e=this;this.$httpServer("/invoiceApplication/getInvoiceApplicationMainInfo.do",{invocieApplicationId:this.invoiceApplicationId}).then(function(t){e.applyMethod=t.applyMethod,e.noticeNo=t.noticeNo,e.contractCode=t.contractCode,e.contractName=t.contractName,e.arrivalCheckBillNo=t.arrivalNos,e.invoiceType=t.noticeStyleName,e.invoiceMoney=t.invoiceApplyMoney,e.taxedMoney=t.invoiceApplyTaxMoney,e.relativerName=t.relativerName,e.invoiceRuleName=t.invoiceRuleName,e.remark=t.description,e.purchaserName=t.invoiceTitle,e.purchaserCreditNo=t.companyCode,e.purchaserBankName=t.bankName,e.purchaserBankAccount=t.bankAccount,e.purchaserAddr=t.companyAddr,e.purchaserTel=t.contactsTel,e.supplierName=t.supplierInvoiceTitle,e.supplierCreditNo=t.supplierCompanyCode,e.supplierBankName=t.supplierBankName,e.supplierBankAccount=t.supplierBankAccount,e.supplierAddr=t.supplierCompanyAddr,e.supplierTel=t.supplierCompanyTel})},invoiceList:function(){var e=this;this.$httpServer("/invoiceApplication/getInvoiceApplicationItemsByAId.do",{invoiceApplicationId:this.invoiceApplicationId}).then(function(t){e.dataList=t;for(var a=0;a<e.dataList.length;a++)e.dataList[a].itemTaxs=100*e.dataList[a].itemTax+"%"})},addInvoice:function(){console.log(this.formDetail),this.modal1=!0,this.digType=!1,this.$refs.formDetail.resetFields()},addInvoiceDetails:function(){this.modalDetails=!0,this.$refs.formDetails.resetFields()},sureInvoice:function(e){var t=this;this.$refs[e].validate(function(e){if(e){if(0==t.digType){if(t.formDetail.invoiceCode==t.formDetail.invoiceNo)return void t.$Message.info("发票代码和发票号码不能一致");t.modal1=!1,t.formDetail.id=t.num++;var a=new Date(t.formDetail.registryDate),i=a.getFullYear()+"-"+d.default.repairZ(a.getMonth()+1)+"-"+d.default.repairZ(a.getDate());return console.log(i),t.formDetail.registryDate=i,t.formDetail.invoiceApplicationId=t.$route.query.invoiceApplicationId,t.detailData.push(t.formDetail),t.$Message.success("保存成功"),console.log(t.detailData),t.formDetail={}}var a=new Date(t.formDetail.registryDate),i=a.getFullYear()+"-"+d.default.repairZ(a.getMonth()+1)+"-"+d.default.repairZ(a.getDate());console.log(i),t.formDetail.registryDate=i,t.formDetail.invoiceApplicationId=t.$route.query.invoiceApplicationId;var n=(0,r.default)({},t.formDetail);console.log(n);for(var o=0;o<t.detailData.length;o++)t.detailData.splice(t.materIndex,1,n);t.modal1=!1,t.$Message.success("修改成功")}else t.$Message.error("请填写发票登记明细!")})},sureDetails:function(e){var t=this;this.$refs[e].validate(function(e){if(e){for(var a=t.formDetails.invoiceStartNo;a<=t.formDetails.invoiceEndNo;a++){var i={};if(i.invoiceCode=t.formDetails.invoiceCode,i.invoiceNo=a.toString(),i.invoiceCode==i.invoiceNo)return void t.$Message.info("发票代码和发票号码不能一致");i.invoiceApplicationId=t.$route.query.invoiceApplicationId,t.formDetail.invoiceNo=i.invoiceNo,i.id=t.num++,i.taxIncludedSum=t.formDetails.taxIncludedSum;var n=new Date(t.formDetails.registryDate),o=n.getFullYear()+"-"+d.default.repairZ(n.getMonth()+1)+"-"+d.default.repairZ(n.getDate());i.registryDate=o,t.detailData.push(i)}return console.log(t.detailData),t.$Message.success("保存成功"),t.modalDetails=!1,t.formDetails={}}t.$Message.error("请填写发票登记明细!")})},clickRow:function(e,t){console.log(e),this.materIndex=t,this.formDetail=e,this.modal1=!0,this.digType=!0,this.$refs.formDetail.resetFields()},selectModel:function(e){console.log(e),this.deleteList=e},deleteFn:function(){if(console.log(this.detailData),console.log(this.deleteList),0!=this.deleteList.length){if(this.deleteList.length==this.detailData.length)this.detailData=[];else for(var e=0;e<this.detailData.length;e++)for(var t=0;t<this.deleteList.length;t++)if(this.detailData[e].id==this.deleteList[t].id){this.$Message.success("删除成功 "),this.detailData.splice(e,this.deleteList.length),this.deleteList=[];break}}else this.$Message.warning("请选择要删除明细")},upFile:function(e){e.target.outerHTML=e.target.outerHTML,this.file=e.target.files[0];var t=e.target.files,a=[];Array.prototype.push.apply(a,t);for(var i=0;i<a.length;i++)this.filesList.push(a[i])},delFile:function(e){this.filesList.splice(e,1)},invoiceSave:function(e){var t=this;if(this.detailData.length<=0)return this.$Message.info("请选择明细"),void(this.loading=!1);var a=new FormData;a.append("flag",e),a.append("invoiceRegistryStr",(0,o.default)(this.detailData));for(var i=0,n=0;n<this.detailData.length;n++)i=Number(i)+Number(this.detailData[n].taxIncludedSum);if(this.invoiceMoney!=i)return this.collapse="1",this.$Message.info("发票金额需等于开票金额"),void(this.loading=!1);for(var l=0;l<this.filesList.length;l++)a.append("files",this.filesList[l]);this.loading=!0,1001==this.$route.query.invoiceState?this.$fdServer("/invoiceRegistry/saveInvoiceRegistry.do",a).then(function(e){console.log(e),200==e.status?(t.$Message.success("保存成功"),t.loading=!1,t.backlist()):t.$Message.error("保存失败")}):this.$fdServer("/invoiceRegistry/updateInvoiceRegistry.do",a).then(function(e){console.log(e),200==e.status?(t.$Message.success("保存成功"),t.loading=!1,t.backlist()):t.$Message.error("保存失败")})},backlist:function(){this.$router.go(-1)},cancel:function(){this.modal1=!1,this.modalDetails=!1},getInvoiceDetail:function(){var e=this;this.$httpServer("/invoiceRegistry/getInvoiceRegistrys.do",{invoiceApplicationId:this.invoiceApplicationId}).then(function(t){e.detailData=t;for(var a=0;a<e.detailData.length;a++)e.detailData[a].registryDate=new Date(t[a].registryDate).Format("yyyy-MM-dd")})}}}}});